<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Captura de cámara trasera</title>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/0.4.1/html2canvas.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
        <script src="https://rawgit.com/schmich/instascan-builds/master/instascan.min.js"></script>
    </head>
    <body>
        <button id="captureButton">Capturar</button>
        <div id="cameraContainer"></div>
        <img id="capturedImage" />

        <script>
            $(document).ready(function () {
                const scanner = new Instascan.Scanner({
                    video: document.getElementById("cameraContainer"),
                });
                scanner.addListener("scan", function (content) {
                    console.log("Escaneado:", content);
                });
                Instascan.Camera.getCameras()
                    .then(function (cameras) {
                        if (cameras.length > 0) {
                            scanner.start(cameras[0]);
                        } else {
                            console.error("No se encontraron cámaras disponibles.");
                        }
                    })
                    .catch(function (error) {
                        console.error("Error al acceder a la cámara:", error);
                    });

                document
                    .getElementById("captureButton")
                    .addEventListener("click", function () {
                        const canvas = document.createElement("canvas");
                        canvas.width = $("#cameraContainer video").width();
                        canvas.height = $("#cameraContainer video").height();
                        const context = canvas.getContext("2d");
                        context.drawImage($("#cameraContainer video")[0], 0, 0);
                        const imageDataURL = canvas.toDataURL("image/png");
                        const capturedImage = document.getElementById("capturedImage");
                        capturedImage.src = imageDataURL;
                        capturedImage.style.display = "block";
                    });
            });
        </script>
    </body>
</html>
